{% extends 'bases.html' %}
{% load static %}

{% block content %}

<style>
    body {
        background: linear-gradient(135deg, #e0eafc 0%, #cfdef3 100%);
        min-height: 100vh;
        font-family: 'Segoe UI', Arial, sans-serif;
    }
    .custom-login-card {
        box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.15);
        border-radius: 18px;
        border: none;
        background: #fff;
        padding: 2.5rem 2rem 2rem 2rem;
        margin-top: 90px;
    }
    .custom-login-card .card-title {
        font-weight: 700;
        color: #198754;
        letter-spacing: 1px;
    }
    .custom-login-card .form-control {
        border-radius: 8px;
        border: 1px solid #d1e7dd;
        box-shadow: none;
        transition: border-color 0.2s;
    }
    .custom-login-card .form-control:focus {
        border-color: #198754;
        box-shadow: 0 0 0 0.1rem rgba(25, 135, 84, 0.15);
    }
    .custom-login-card .btn-primary {
        background: #198754;
        border: none;
        border-radius: 8px;
        font-weight: 600;
        transition: background 0.2s;
    }
    .custom-login-card .btn-primary:hover {
        background: #157347;
    }
    .custom-login-card a {
        color: #198754;
        text-decoration: none;
        font-weight: 500;
    }
    .custom-login-card a:hover {
        text-decoration: underline;
        color: #145c32;
    }
    .custom-login-card .alert {
        border-radius: 8px;
    }
    .custom-login-card .form-group {
        margin-bottom: 1.2rem;
    }
    .custom-login-footer {
        text-align: center;
        margin-top: 2rem;
        color: #6c757d;
    }
    .custom-login-footer a {
        color: #198754;
        font-weight: 500;
    }
    .custom-login-footer a:hover {
        color: #145c32;
        text-decoration: underline;
    }
    #installApp {
        display: none;
        background-color: #198754;
        color: #fff;
        border: none;
        padding: 10px 20px;
        border-radius: 8px;
        font-size: 1rem;
        cursor: pointer;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        margin-top: 20px;
        width: 100%;
    }
    #installApp:hover {
        background-color: #157347;
    }
</style>

<!-- Manifest JSON -->
<script type="application/manifest+json">
{
  "name": "BestStore",
  "short_name": "BestStore",
  "start_url": "/",
  "display": "standalone",
  "background_color": "#ffffff",
  "theme_color": "#198754",
  "icons": [
    {
      "src": "/static/icons/icon-192x192.png",
      "sizes": "192x192",
      "type": "image/png"
    },
    {
      "src": "/static/icons/icon-512x512.png",
      "sizes": "512x512",
      "type": "image/png"
    }
  ]
}
</script>

<section class="section-conten padding-y" style="min-height:84vh">

{% if request.GET.command == 'verification' %}
<div class="container mx-auto alert alert-info text-center" role="alert" style="max-width: 1024px; margin-top:100px;">
Thank you for registering with us. We have sent you a verification email to your email address [{{ request.GET.email }}]
<br><br>
Already verified? <a href="{% url 'login' %}">Login</a>
</div>
{% else %}
    <div class="card custom-login-card mx-auto" style="max-width: 380px;">
      <div class="card-body">
        <h4 class="card-title mb-4 text-center">Hi Guest, Welcome Back!</h4>
        <h4 class="card-title mb-4">Sign in</h4>
      {% include 'includes/alerts.html' %}
      <form action="{% url 'login' %}" method="POST">
        {% csrf_token %}
          <div class="form-group">
             <input type="email" class="form-control" placeholder="Email Address" name="email" required>
          </div>
          <div class="form-group">
            <input type="password" class="form-control" placeholder="Password" name="password" required>
          </div>
          <div class="form-group">
              <a href="{% url 'forgotPassword' %}" class="float-right">Forgot password?</a>
          </div>
          <div class="form-group">
              <button type="submit" class="btn btn-primary btn-block w-100"> Login  </button>
          </div>
      </form>
      </div>
    </div>
    <p class="custom-login-footer">Don't have account? <a href="{% url 'register' %}">Sign up</a></p>
    <br><br>
{% endif %}

<!-- Install App Button -->
<div class="text-center">
    <button id="installApp">Install App</button>
</div>

</section>

<script>
    let deferredPrompt;

    // Listen for the beforeinstallprompt event
    window.addEventListener("beforeinstallprompt", (e) => {
        e.preventDefault(); // Prevent the default install prompt
        deferredPrompt = e; // Save the event for later use

        // Show the install button
        const installButton = document.getElementById("installApp");
        if (installButton) {
            installButton.style.display = "block";

            // Handle the install button click
            installButton.addEventListener("click", () => {
                deferredPrompt.prompt(); // Show the install prompt
                deferredPrompt.userChoice.then((choiceResult) => {
                    if (choiceResult.outcome === "accepted") {
                        console.log("User accepted the install prompt");
                    } else {
                        console.log("User dismissed the install prompt");
                    }
                    deferredPrompt = null; // Reset the deferred prompt
                });
            });
        }
    });

    // Hide the install button if the app is already installed
    window.addEventListener("appinstalled", () => {
        console.log("PWA was installed");
        const installButton = document.getElementById("installApp");
        if (installButton) {
            installButton.style.display = "none";
        }
    });
</script>

{% endblock %}